<ion-header>
  <ion-toolbar>
    <ion-title>Chat</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content #chatContainer>
  <!-- Chat messages will be rendered here dynamically -->
  <div *ngFor="let message of messages" class="flex" [class.justify-end]="message.role === 'user'" [class.justify-start]="message.role === 'assistant'">
    <div class="p-3 rounded-lg max-w-xl"
         [class.user-message-bubble]="message.role === 'user'">
      <div class="chat-message-content" [innerHTML]="message.content"></div>
    </div>
  </div>

  <!-- Status and Thinking Indicator -->
  <div *ngIf="isLoading || currentStatusMessage !== 'Thinking...'" class="flex justify-center">
    <div class="p-3 rounded-lg max-w-xl flex items-center space-x-2">
      <span>{{ currentStatusMessage }}</span>
      <span *ngIf="isLoading" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></span>
    </div>
  </div>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <div class="flex items-center p-2">
      <ion-textarea
        #messageInput
        rows="1"
        class="flex-1 resize-none outline-none bg-transparent text-white placeholder-gray-400 p-2"
        placeholder="Type your message..."
        [(ngModel)]="newMessage"
        (ionInput)="adjustTextareaHeight()"
        (keydown.enter)="sendMessage(); $event.preventDefault();"
        [disabled]="isLoading"
      ></ion-textarea>
      <ion-button (click)="sendMessage()" [disabled]="isLoading">
        Send
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
