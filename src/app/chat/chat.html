<div class="flex flex-col h-screen text-white bg-transparent">
  <!-- Chat Area -->
  <div #chatContainer class="flex-1 overflow-y-auto p-4 space-y-4">
    <!-- Chat messages will be rendered here dynamically -->
    <div *ngFor="let message of orchestrator.messages" class="flex" [class.justify-end]="message.sender === 'user'" [class.justify-start]="message.sender === 'ai'">
      <div class="glass-card p-3 rounded-lg max-w-xl"
           [class.user-message-bubble]="message.sender === 'user'">
        <div class="chat-message-content" [innerHTML]="message.content"></div>
      </div>
    </div>

    <!-- Thinking indicator -->
    <div *ngIf="orchestrator.isLoading" class="flex justify-center" (click)="toggleThinkingModal()">
      <div class="glass-card p-3 rounded-lg max-w-xl cursor-pointer flex items-center space-x-2">
        <span>{{ orchestrator.thinkingMessage }}</span>
        <span class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></span>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="p-4">
    <div class="flex items-center glass-container p-2 rounded-lg">
      <textarea
        #messageInput
        rows="1"
        class="flex-1 resize-none outline-none bg-transparent text-white placeholder-gray-400 glass-input p-2"
        placeholder="Type your message..."
        [(ngModel)]="orchestrator.newMessage"
        (input)="adjustTextareaHeight()"
        (keydown.enter)="sendMessage(); $event.preventDefault();"
      ></textarea>
      <button class="ml-2 px-4 py-2 glass-button bg-blue-600/50 hover:bg-blue-700/60 rounded-lg font-semibold"
              (click)="sendMessage()">
        Send
      </button>
    </div>
  </div>

  <!-- Thinking Modal -->
  <div *ngIf="orchestrator.showThinkingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="toggleThinkingModal()">
    <div class="glass-container p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col" (click)="$event.stopPropagation()">
      <h2 class="text-xl font-bold mb-4 text-center">AI Execution Details</h2>

      <div class="flex-1 flex flex-col md:flex-row md:space-x-4 overflow-y-hidden">
        <!-- Breakdown Steps -->
        <div class="flex-1 flex flex-col log-container-plan">
          <h3 class="font-semibold text-lg mb-2">Plan</h3>
          <div class="flex-1 bg-black/20 p-3 rounded-lg overflow-y-auto">
            <ol *ngIf="orchestrator.breakdownSteps.length > 0" class="list-decimal list-inside space-y-1 text-gray-200">
              <li *ngFor="let step of orchestrator.breakdownSteps">{{ step }}</li>
            </ol>
            <p *ngIf="orchestrator.breakdownSteps.length === 0" class="text-gray-400">No breakdown steps generated yet.</p>
          </div>
        </div>

        <!-- Execution Log -->
        <div class="flex-1 flex flex-col log-container-execution mt-4 md:mt-0">
          <h3 class="font-semibold text-lg mb-2">Execution Log</h3>
          <div class="flex-1 bg-black/20 p-3 rounded-lg overflow-y-auto font-mono text-sm">
            <div *ngIf="orchestrator.execution_context.length > 0" class="space-y-2">
              <pre *ngFor="let entry of orchestrator.execution_context" class="whitespace-pre-wrap">{{ entry }}</pre>
            </div>
            <p *ngIf="orchestrator.execution_context.length === 0" class="text-gray-400">Execution has not started yet.</p>
          </div>
        </div>
      </div>

      <button class="mt-6 px-4 py-2 glass-button bg-red-600/50 hover:bg-red-700/60 rounded-lg font-semibold w-full" (click)="toggleThinkingModal()">
        Close
      </button>
    </div>
  </div>
</div>
