<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/cases"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ isEditMode ? 'Edit Case' : 'New Case' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-content>
      <div *ngIf="isLoading" class="ion-text-center ion-padding">
        <p>Loading case details...</p>
        <ion-spinner name="crescent"></ion-spinner>
      </div>

      <form *ngIf="!isLoading" (ngSubmit)="saveCase()">
        <ion-list lines="full">
          <ion-item>
            <ion-select label="Employee" [(ngModel)]="caseItem.employee_id" name="employee_id" required>
              <ion-select-option [value]="null" disabled>Select an Employee</ion-select-option>
              <ion-select-option *ngFor="let app of applicants" [value]="app.id">
                {{ app.last_name }}, {{ app.first_name }} ({{ app.passport_number }})
              </ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-input label="Category" type="text" [(ngModel)]="caseItem.category" name="category" required></ion-input>
          </ion-item>

          <ion-item>
            <ion-textarea label="Report" rows="5" [(ngModel)]="caseItem.report" name="report" required></ion-textarea>
          </ion-item>

          <ion-item>
            <ion-select label="Status" [(ngModel)]="caseItem.report_status" name="report_status" required>
              <ion-select-option value="open">Open</ion-select-option>
              <ion-select-option value="closed">Closed</ion-select-option>
              <ion-select-option value="pending">Pending</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-input label="Agency ID (Optional)" type="number" [(ngModel)]="caseItem.agency_id" name="agency_id"></ion-input>
          </ion-item>
        </ion-list>

        <div class="ion-padding-top ion-text-right">
          <ion-button fill="clear" (click)="router.navigate(['/admin/cases'])">Cancel</ion-button>
          <ion-button type="submit">{{ isEditMode ? 'Update Case' : 'Create Case' }}</ion-button>
        </div>
      </form>
    </ion-card-content>
  </ion-card>
</ion-content>
